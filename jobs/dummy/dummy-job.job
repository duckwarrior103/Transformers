#!/bin/bash

# SBATCH directives (converted from srun)
#SBATCH --partition=gpuA
#SBATCH --gpus=1
#SBATCH -c 4
#SBATCH --ntasks=1
#SBATCH --time=1-0

# Exit immediately if a command exits with a non-zero status
set -e

echo "Starting batch GPU job (1x A100, 4 CPU cores, 1 day)..."

# Load modules (same as original)
echo 'Loading modules...'
module load apps/binapps/conda/miniforge3/25.9.1
module load libs/cuda/12.4.1
module load apps/binapps/pytorch/2.6.0-312-gpu-cu124

# Activate virtual environment (absolute path for robustness)
echo 'Activating virtual environment...'
source /mnt/iusers01/fse-ugpgt01/compsci01/j84846ky/scratch/Transformers/.venv/bin/activate

# Echo job details
echo "Job is using $SLURM_GPUS GPU(s) with ID(s) $CUDA_VISIBLE_DEVICES and $SLURM_NTASKS CPU core(s)"

# Running test.py
echo 'Running test.py'
echo "===== the following will be job output ===="

# Run your GPU app (absolute path for robustness, replace with actual command if needed)
python /mnt/iusers01/fse-ugpgt01/compsci01/j84846ky/scratch/Transformers/test.py

echo 'Job completed.'